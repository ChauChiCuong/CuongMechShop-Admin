<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin User Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
        .password-field {
            position: relative;
        }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #6b7280;
        }
        .sidebar {
            transition: all 0.3s ease;
        }
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                z-index: 50;
            }
            .sidebar.active {
                left: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div class="sidebar bg-indigo-800 text-white w-64 flex-shrink-0">
            <div class="p-4 flex items-center justify-between border-b border-indigo-700">
                <div class="flex flex-col">
                    <h1 class="text-xl font-bold">
                        <span class="text-white">Cuong</span>
                        <span class="text-cyan-400">Mech</span>
                        <span class="text-orange-500">Shop</span>
                    </h1>
                    <p class="text-sm text-gray-300">Admin Panel</p>
                </div>
                <button id="sidebarToggle" class="md:hidden text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="p-4">
                <div class="mb-6">
                    <div class="flex items-center space-x-3 p-3 bg-indigo-900 rounded-lg">
                        <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div>
                            <p class="font-medium">Admin</p>
                            <p class="text-xs text-indigo-300">Super Admin</p>
                        </div>
                    </div>
                </div>
                <ul>
                    <li class="mb-2">
                        <a href="#" class="flex items-center p-3 rounded-lg bg-indigo-900">
                            <i class="fas fa-users mr-3"></i>
                            <span>User Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center p-3 rounded-lg hover:bg-indigo-700">
                            <i class="fas fa-sign-out-alt mr-3"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <!-- Header -->
            <header class="bg-white shadow-sm p-4 flex items-center justify-between">
                <button id="mobileSidebarToggle" class="md:hidden text-gray-600">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input
                            type="text"
                            placeholder="Search..."
                            class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        />
                    </div>
                    <div class="relative">
                        <i class="fas fa-bell text-gray-600 cursor-pointer"></i>
                        <span
                            class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-white text-xs flex items-center justify-center"
                            >3</span
                        >
                    </div>
                </div>
            </header>

            <!-- Content -->
            <main class="p-6">
                <div
                    class="flex flex-col md:flex-row md:items-center md:justify-between mb-6"
                >
                    <h2 class="text-2xl font-bold text-gray-800">User Management</h2>
                    <button
                        id="addUserBtn"
                        class="mt-4 md:mt-0 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center"
                    >
                        <i class="fas fa-plus mr-2"></i> Add New User
                    </button>
                </div>

                <!-- User Table -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                                    >
                                        ID
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                                    >
                                        Username
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                                    >
                                        Info
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                                    >
                                        Email
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                                    >
                                        Role
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                                    >
                                        Status
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                                    >
                                        Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody
                                id="userTableBody"
                                class="bg-white divide-y divide-gray-200"
                            >
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="flex items-center justify-between mt-4">
                    <div class="text-sm text-gray-500">
                        Showing
                        <span id="startItem">1</span> to
                        <span id="endItem">10</span> of
                        <span id="totalItems">0</span> users
                    </div>
                    <div class="flex space-x-2">
                        <button
                            id="prevPage"
                            class="px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-50"
                            disabled
                        >
                            Previous
                        </button>
                        <button
                            id="nextPage"
                            class="px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-50"
                            disabled
                        >
                            Next
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Removed Device ID Modal and Overlay related to device check -->

    <script>
        // DOM Elements
        const sidebar = document.querySelector(".sidebar");
        const sidebarToggle = document.getElementById("sidebarToggle");
        const mobileSidebarToggle = document.getElementById("mobileSidebarToggle");
        const userModal = document.getElementById("userModal");
        const deleteModal = document.getElementById("deleteModal");
        const addUserBtn = document.getElementById("addUserBtn");
        const closeModal = document.getElementById("closeModal");
        const cancelBtn = document.getElementById("cancelBtn");
        const cancelDelete = document.getElementById("cancelDelete");
        const confirmDelete = document.getElementById("confirmDelete");
        const userForm = document.getElementById("userForm");
        const userTableBody = document.getElementById("userTableBody");
        const prevPageBtn = document.getElementById("prevPage");
        const nextPageBtn = document.getElementById("nextPage");
        const startItem = document.getElementById("startItem");
        const endItem = document.getElementById("endItem");
        const totalItems = document.getElementById("totalItems");

        // State
        let currentPage = 1;
        const itemsPerPage = 5;
        let users = [];
        let userToDelete = null;

        // Generate device ID - removed since no longer needed

        // Initialize
        document.addEventListener("DOMContentLoaded", () => {
            loadUsers();
            setupEventListeners();
            // generateDeviceId(); -- removed
        });

        // Event Listeners
        function setupEventListeners() {
            // Sidebar toggle
            mobileSidebarToggle.addEventListener("click", () => {
                sidebar.classList.add("active");
            });

            sidebarToggle.addEventListener("click", () => {
                sidebar.classList.remove("active");
            });

            // User modal
            addUserBtn.addEventListener("click", () => {
                document.getElementById("modalTitle").textContent = "Add New User";
                document.getElementById("userId").value = "";
                userForm.reset();
                document.getElementById("password").type = "password";
                document
                    .querySelector("#password + .toggle-password i")
                    .classList.remove("fa-eye-slash");
                document
                    .querySelector("#password + .toggle-password i")
                    .classList.add("fa-eye");
                userModal.classList.remove("hidden");
            });

            closeModal.addEventListener("click", () => {
                userModal.classList.add("hidden");
            });

            cancelBtn.addEventListener("click", () => {
                userModal.classList.add("hidden");
            });

            // Delete modal
            cancelDelete.addEventListener("click", () => {
                deleteModal.classList.add("hidden");
            });

            confirmDelete.addEventListener("click", () => {
                if (userToDelete) {
                    deleteUser(userToDelete);
                    deleteModal.classList.add("hidden");
                    userToDelete = null;
                }
            });

            // Form submission
            userForm.addEventListener("submit", (e) => {
                e.preventDefault();
                saveUser();
            });

            // Pagination
            prevPageBtn.addEventListener("click", () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderUsers();
                }
            });

            nextPageBtn.addEventListener("click", () => {
                const totalPages = Math.ceil(users.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderUsers();
                }
            });
        }

        // Toggle password visibility
        function togglePasswordVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = document.querySelector(`#${fieldId} + .toggle-password i`);

            if (field.type === "password") {
                field.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                field.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }

        // Load users from localStorage
        function loadUsers() {
            const storedUsers = localStorage.getItem("admin_users");
            if (storedUsers) {
                users = JSON.parse(storedUsers);
            } else {
                // Default admin user
                users = [
                    {
                        id: generateId(),
                        firstName: "Admin",
                        lastName: "System",
                        username: "admin",
                        email: "admin@example.com",
                        zaloPhone: "0123456789",
                        currentRank: "Admin",
                        currentLevel: 99,
                        password: "admin123",
                        role: "admin",
                        status: "active",
                    },
                ];
                saveUsersToStorage();
            }
            renderUsers();
        }

        // Save users to localStorage
        function saveUsersToStorage() {
            localStorage.setItem("admin_users", JSON.stringify(users));
        }

        // Generate unique ID
        function generateId() {
            return (
                Date.now().toString(36) + Math.random().toString(36).substr(2)
            );
        }

        // Render users in table
        function renderUsers() {
            userTableBody.innerHTML = "";

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, users.length);
            const paginatedUsers = users.slice(startIndex, endIndex);

            if (paginatedUsers.length === 0) {
                userTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">No users found</td>
                    </tr>
                `;
            } else {
                paginatedUsers.forEach((user) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.id.substring(
                            0,
                            8
                        )}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${
                                user.firstName || ""
                            } ${user.lastName || ""}</div>
                            <div class="text-sm text-gray-500">${user.username}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${
                                user.zaloPhone || "N/A"
                            }</div>
                            <div class="text-sm text-gray-500">${
                                user.currentRank || "N/A"
                            } (Lv. ${user.currentLevel || "0"})</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                            user.email
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${
                                    user.role === "admin"
                                        ? "bg-purple-100 text-purple-800"
                                        : user.role === "moderator"
                                        ? "bg-blue-100 text-blue-800"
                                        : "bg-green-100 text-green-800"
                                }">
                                ${
                                    user.role === "player"
                                        ? "Player"
                                        : user.role
                                }
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${
                                    user.status === "active"
                                        ? "bg-green-100 text-green-800"
                                        : user.status === "banned"
                                        ? "bg-gray-100 text-gray-800"
                                        : "bg-red-100 text-red-800"
                                }">
                                ${user.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button onclick="editUser('${user.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="confirmDeleteUser('${user.id}')" class="text-red-600 hover:text-red-900">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    userTableBody.appendChild(row);
                });
            }

            // Update pagination info
            startItem.textContent = startIndex + 1;
            endItem.textContent = endIndex;
            totalItems.textContent = users.length;

            // Enable/disable pagination buttons
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === Math.ceil(users.length / itemsPerPage);
        }

        // Save user (add or edit)
        function saveUser() {
            const userId = document.getElementById("userId").value;
            const firstName = document.getElementById("firstName").value;
            const lastName = document.getElementById("lastName").value;
            const username = document.getElementById("username").value;
            const email = document.getElementById("email").value;
            const zaloPhone = document.getElementById("zaloPhone").value;
            const currentRank = document.getElementById("currentRank").value;
            const currentLevel = document.getElementById("currentLevel").value;
            const password = document.getElementById("password").value;
            const role = document.getElementById("role").value;
            const status = document.querySelector('input[name="status"]:checked').value;

            if (userId) {
                // Edit existing user
                const index = users.findIndex((u) => u.id === userId);
                if (index !== -1) {
                    users[index] = {
                        ...users[index],
                        username,
                        email,
                        password: password || users[index].password,
                        role,
                        status,
                    };
                }
            } else {
                // Add new user
                const newUser = {
                    id: generateId(),
                    username,
                    email,
                    password,
                    role,
                    status,
                };
                users.push(newUser);
            }

            saveUsersToStorage();
            userModal.classList.add("hidden");
            renderUsers();
        }

        // Edit user
        function editUser(id) {
            const user = users.find((u) => u.id === id);
            if (user) {
                document.getElementById("modalTitle").textContent = "Edit User";
                document.getElementById("userId").value = user.id;
                document.getElementById("firstName").value = user.firstName || "";
                document.getElementById("lastName").value = user.lastName || "";
                document.getElementById("username").value = user.username;
                document.getElementById("email").value = user.email;
                document.getElementById("zaloPhone").value = user.zaloPhone || "";
                document.getElementById("currentRank").value = user.currentRank || "";
                document.getElementById("currentLevel").value = user.currentLevel || "";
                document.getElementById("password").value = user.password;
                document.getElementById("password").type = "text";
                document
                    .querySelector("#password + .toggle-password i")
                    .classList.remove("fa-eye");
                document
                    .querySelector("#password + .toggle-password i")
                    .classList.add("fa-eye-slash");
                document.getElementById("role").value = user.role;
                document.querySelector(`input[name="status"][value="${user.status}"]`).checked = true;
                userModal.classList.remove("hidden");
            }
        }

        // Confirm delete user
        function confirmDeleteUser(id) {
            userToDelete = id;
            deleteModal.classList.remove("hidden");
        }

        // Delete user
        function deleteUser(id) {
            users = users.filter((u) => u.id !== id);
            saveUsersToStorage();
            renderUsers();
        }
    </script>

    <!-- User Modal and Delete Modal here -->
    <div
        id="userModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 id="modalTitle" class="text-lg font-semibold">Add New User</h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="userForm" class="p-4 pb-8">
                <input type="hidden" id="userId" />
                <div class="mb-4">
                    <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">Tên</label>
                    <input
                        type="text"
                        id="firstName"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        required
                    />
                </div>
                <div class="mb-4">
                    <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">Họ tên</label>
                    <input
                        type="text"
                        id="lastName"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        required
                    />
                </div>
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input
                        type="text"
                        id="username"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        required
                    />
                </div>
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input
                        type="email"
                        id="email"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        required
                    />
                </div>
                <div class="mb-4">
                    <label for="zaloPhone" class="block text-sm font-medium text-gray-700 mb-1">Số điện thoại Zalo</label>
                    <input
                        type="tel"
                        id="zaloPhone"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                </div>
                <div class="mb-4">
                    <label for="currentRank" class="block text-sm font-medium text-gray-700 mb-1">Rank hiện tại</label>
                    <input
                        type="text"
                        id="currentRank"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                </div>
                <div class="mb-4">
                    <label for="currentLevel" class="block text-sm font-medium text-gray-700 mb-1">Lv. hiện tại</label>
                    <input
                        type="number"
                        id="currentLevel"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                </div>
                <div class="mb-4 password-field">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input
                        type="password"
                        id="password"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        required
                    />
                    <span class="toggle-password" onclick="togglePasswordVisibility('password')">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>
                <div class="mb-4">
                    <label for="role" class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                    <select
                        id="role"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    >
                        <option value="player">Player</option>
                        <option value="admin">Admin</option>
                        <option value="moderator">Moderator</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                    <div class="flex space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="status" value="active" class="text-indigo-600" checked />
                            <span class="ml-2">Active</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="status" value="inactive" class="text-indigo-600" />
                            <span class="ml-2">Inactive</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="status" value="banned" class="text-indigo-600" />
                            <span class="ml-2">Banned</span>
                        </label>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button
                        type="button"
                        id="cancelBtn"
                        class="px-4 py-2 border rounded-lg hover:bg-gray-100"
                    >
                        Cancel
                    </button>
                    <button
                        type="submit"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                    >
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div
        id="deleteModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-4 border-b">
                <h3 class="text-lg font-semibold">Confirm Deletion</h3>
            </div>
            <div class="p-4">
                <p>Are you sure you want to delete this user? This action cannot be undone.</p>
            </div>
            <div
                class="p-4 border-t flex justify-end space-x-3"
            >
                <button
                    id="cancelDelete"
                    class="px-4 py-2 border rounded-lg hover:bg-gray-100"
                >
                    Cancel
                </button>
                <button
                    id="confirmDelete"
                    class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
                >
                    Delete
                </button>
            </div>
        </div>
    </div>
</body>
</html>


